@model List<WebXemPhim.Models.Movie>
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewBag.Title = "Phim mới cập nhật";
}

<style>
    /* 1. Thiết lập font và nền đặc trưng của hệ thống MOVIEPRO */
    body {
        background-color: #0f172a !important; /* Xanh Midnight */
        font-family: 'Poppins', sans-serif;
    }

    /* 2. Nâng cấp Banner */
    .carousel-item img {
        height: 500px;
        object-fit: cover;
        filter: brightness(50%);
        transition: transform 3s ease-in-out;
    }

    .carousel-item.active img {
        transform: scale(1.1);
    }

    .carousel-caption h2 {
        font-size: 3.5rem;
        font-weight: 800;
        letter-spacing: -1px;
        text-shadow: 0 5px 15px rgba(0,0,0,0.5);
    }

    /* 3. Tiêu đề mục "Phim mới cập nhật" */
    .section-header {
        border-bottom: 2px solid rgba(255, 255, 255, 0.05);
        padding-bottom: 15px;
        margin-bottom: 30px;
    }

    .section-title {
        color: #fbbf24; /* Màu vàng cam rực rỡ */
        font-weight: 800;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    /* 4. Movie Card đồng bộ với các trang khác */
    .movie-card-premium {
        background-color: #1e293b;
        border-radius: 16px;
        overflow: hidden;
        transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
        border: 1px solid rgba(255, 255, 255, 0.03);
        height: 100%;
        position: relative;
    }

        .movie-card-premium:hover {
            transform: translateY(-12px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4), 0 0 20px rgba(229, 9, 20, 0.2);
            border-color: rgba(229, 9, 20, 0.4);
        }

    .movie-poster-wrapper {
        position: relative;
        overflow: hidden;
    }

        .movie-poster-wrapper img {
            height: 320px;
            width: 100%;
            object-fit: cover;
            transition: transform 0.6s ease;
        }

    .movie-card-premium:hover img {
        transform: scale(1.1);
    }

    .movie-overlay-play {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.4);
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: opacity 0.3s;
        z-index: 3;
    }

    .movie-card-premium:hover .movie-overlay-play {
        opacity: 1;
    }

    .play-btn-circle {
        width: 60px;
        height: 60px;
        background: #e50914;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 0 20px rgba(229, 9, 20, 0.6);
    }

    /* 5. Pagination (Phân trang) */
    .pagination .page-link {
        background-color: #1e293b;
        border: none;
        color: #94a3b8;
        margin: 0 4px;
        border-radius: 8px;
        font-weight: 600;
    }

    .pagination .page-item.active .page-link {
        background-color: #e50914;
        color: white;
    }
</style>

<div class="container mt-4">
    <div id="heroMovieCarousel" class="carousel slide mb-5 shadow-lg" data-bs-ride="carousel" data-bs-interval="4000">
        <div class="carousel-indicators">
            <button type="button" data-bs-target="#heroMovieCarousel" data-bs-slide-to="0" class="active"></button>
            <button type="button" data-bs-target="#heroMovieCarousel" data-bs-slide-to="1"></button>
            <button type="button" data-bs-target="#heroMovieCarousel" data-bs-slide-to="2"></button>
        </div>
        <div class="carousel-inner rounded-4">
            <div class="carousel-item active">
                <img src="https://pub-c488fe8ca9644407b061581e16fd9246.r2.dev/banner/banner1.jpg" class="d-block w-100" alt="Banner 1">
                <div class="carousel-caption d-none d-md-block" style="bottom: 20%;">
                    <h2 class="text-uppercase mb-3">Siêu Phẩm Hành Động 2026</h2>
                    <p class="fs-5 mb-4 opacity-75">Trải nghiệm hình ảnh 4K sắc nét và âm thanh sống động nhất.</p>
                    <a href="#section-phim-moi" class="btn btn-danger btn-lg rounded-pill px-5 py-3 fw-bold shadow scroll-btn">
                        <i class="fa-solid fa-circle-play me-2"></i>XEM NGAY
                    </a>
                </div>
            </div>

            <div class="carousel-item">
                <img src="https://pub-c488fe8ca9644407b061581e16fd9246.r2.dev/banner/banner2.jpg" class="d-block w-100" alt="Banner 2">
                <div class="carousel-caption d-none d-md-block" style="bottom: 20%;">
                    <h2 class="text-uppercase mb-3">Thế Giới Điện Ảnh</h2>
                    <p class="fs-5 mb-4 opacity-75">Cập nhật những bộ phim hot nhất từ các rạp chiếu toàn cầu.</p>
                    <a href="#section-phim-moi" class="btn btn-danger btn-lg rounded-pill px-5 py-3 fw-bold shadow scroll-btn">
                        <i class="fa-solid fa-circle-play me-2"></i>KHÁM PHÁ
                    </a>
                </div>
            </div>

            <div class="carousel-item">
                <img src="https://pub-c488fe8ca9644407b061581e16fd9246.r2.dev/banner/banner3.jpg" class="d-block w-100" alt="Banner 3">
                <div class="carousel-caption d-none d-md-block" style="bottom: 20%;">
                    <h2 class="text-uppercase mb-3">Giải Trí Đỉnh Cao</h2>
                    <p class="fs-5 mb-4 opacity-75">Tương thích hoàn hảo trên mọi thiết bị thông minh của bạn.</p>
                    <a href="#section-phim-moi" class="btn btn-danger btn-lg rounded-pill px-5 py-3 fw-bold shadow scroll-btn">
                        <i class="fa-solid fa-circle-play me-2"></i>BẮT ĐẦU NGAY
                    </a>
                </div>
            </div>
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#heroMovieCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon"></span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#heroMovieCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon"></span>
        </button>
    </div>

    <div id="section-phim-moi" class="section-header d-flex align-items-center" style="scroll-margin-top: 100px;">
        <h2 class="section-title mb-0">
            <i class="fa-solid fa-bolt-lightning me-2"></i> @ViewBag.Title
        </h2>
    </div>

    @if (Model != null && Model.Any())
    {
        <div class="row g-4">
            @foreach (var phim in Model)
            {
                <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6">
                    <div class="movie-card-premium">
                        <div class="movie-poster-wrapper">
                            <span class="movie-badge" style="position: absolute; top: 12px; left: 12px; background: #e50914; color: white; padding: 2px 10px; border-radius: 6px; font-size: 0.7rem; z-index: 5; font-weight: bold; box-shadow: 0 2px 10px rgba(0,0,0,0.5);">HD</span>

                            <img src="@phim.PosterUrl" alt="@phim.Title">

                            <div class="movie-overlay-play">
                                <div class="play-btn-circle">
                                    <i class="fa-solid fa-play text-white" style="font-size: 1.2rem; margin-left: 4px;"></i>
                                </div>
                            </div>
                        </div>

                        <div class="p-3 text-center">
                            <a href="@Url.Action("Detail", "UserMovies", new { id = phim.MovieId })" class="movie-title text-decoration-none text-white fw-bold d-block mb-2" style="font-size: 0.9rem; min-height: 2.7rem; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;" title="@phim.Title">
                                @phim.Title
                            </a>

                            <div class="d-flex justify-content-between px-1 mb-3">
                                <small class="text-muted" style="font-size: 0.75rem;">
                                    <i class="fa-regular fa-calendar me-1"></i> @Html.Raw(phim.ReleaseYear != null ? phim.ReleaseYear.ToString() : "&nbsp;")
                                </small>
                                <small class="text-muted" style="font-size: 0.75rem;">
                                    <i class="fa-solid fa-earth-asia me-1"></i> @Html.Raw(!string.IsNullOrWhiteSpace(phim.Country) ? phim.Country : "&nbsp;")
                                </small>
                            </div>

                            <a href="@Url.Action("Detail", "UserMovies", new { id = phim.MovieId })" class="btn btn-danger btn-sm w-100 rounded-pill py-2 fw-bold shadow-sm transition-all" style="font-size: 0.8rem; letter-spacing: 0.5px;">
                                XEM NGAY
                            </a>
                        </div>
                    </div>
                </div>
            }
        </div>
    }

    @if (ViewBag.TotalPages > 1)
    {
        <nav aria-label="Page navigation" class="mt-5 mb-5">
            <ul class="pagination justify-content-center">
                @if (ViewBag.CurrentPage > 1)
                {
                    <li class="page-item">
                        <a class="page-link shadow-sm" href="@Url.Action("Index", "Home", new { page = (int)ViewBag.CurrentPage - 1 })">
                            <i class="fa-solid fa-chevron-left"></i>
                        </a>
                    </li>
                }

                @for (int i = 1; i <= (int)ViewBag.TotalPages; i++)
                {
                    <li class="page-item @(i == (int)ViewBag.CurrentPage ? "active" : "")">
                        <a class="page-link shadow-sm" href="@Url.Action("Index", "Home", new { page = i })">@i</a>
                    </li>
                }

                @if (ViewBag.CurrentPage < (int)ViewBag.TotalPages)
                {
                    <li class="page-item">
                        <a class="page-link shadow-sm" href="@Url.Action("Index", "Home", new { page = (int)ViewBag.CurrentPage + 1 })">
                            <i class="fa-solid fa-chevron-right"></i>
                        </a>
                    </li>
                }
            </ul>
        </nav>
    }
</div>

@section scripts {
    <script>
        $(document).ready(function () {
            // Khởi tạo Carousel mượt mà
            var myCarousel = document.querySelector('#heroMovieCarousel');
            if (myCarousel) {
                var carousel = new bootstrap.Carousel(myCarousel, {
                    interval: 4000,
                    ride: 'carousel',
                    wrap: true
                });
            }

            // Hiệu ứng cuộn mượt cho nút Banner
            $('.scroll-btn').on('click', function (e) {
                if (this.hash !== "") {
                    e.preventDefault();
                    var hash = this.hash;
                    $('html, body').animate({
                        scrollTop: $(hash).offset().top - 100
                    }, 600);
                }
            });
        });
    </script>
}